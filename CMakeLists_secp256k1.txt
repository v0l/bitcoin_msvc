cmake_minimum_required (VERSION 3.11)
project (secp256k1)

include_directories("." "src" "include" "${PROJECT_BINARY_DIR}") 
configure_file(libsecp256k1-config.h.in ${PROJECT_BINARY_DIR}/libsecp256k1-config.h)

option(USE_ECMULT_STATIC_PRECOMPUTATION "enable precomputed ecmult table for signing (default is yes)" ON)
option(ENABLE_MODULE_RECOVERY "enable ECDSA pubkey recovery module (default is no)" OFF)
option(ENABLE_MODULE_ECDH "enable ECDH shared secret computation (experimental)" OFF)

if(ENABLE_MODULE_RECOVERY)
	add_definitions(-DENABLE_MODULE_RECOVERY=1)
	set(RECOVERY_INCLUDE
		"include/secp256k1_recovery.h"
	)
endif(ENABLE_MODULE_RECOVERY)

if(ENABLE_MODULE_ECDH)
	add_definitions(-DENABLE_MODULE_ECDH=1)
	set(ECDH_INCLUDE 
		"include/secp256k1_ecdh.h"
	)
endif(ENABLE_MODULE_ECDH)

if(USE_ECMULT_STATIC_PRECOMPUTATION)
	add_executable(secp256k1_gen_context src/gen_context.c)
	set(ECMULT_STATIC 
		src/ecmult_static_context.h
	)
endif(USE_ECMULT_STATIC_PRECOMPUTATION)

add_definitions(-DSECP256K1_BUILD)

add_library(secp256k1 STATIC
	include/secp256k1.h
	src/secp256k1.c
		
	${RECOVERY_INCLUDE}
	${ECDH_INCLUDE}
	${ECMULT_STATIC}
)